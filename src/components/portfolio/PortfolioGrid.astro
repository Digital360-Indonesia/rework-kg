---
/**
 * PortfolioGrid component
 * Displays portfolio items in a responsive grid layout
 * Features:
 * - Responsive grid (1 col mobile, 2 tablet, 3-4 desktop)
 * - Hover effects with overlay
 * - Category filter support
 * - Click to open lightbox
 */

import type { PortfolioItem } from '../../data/portfolio';

interface Props {
  items: PortfolioItem[];
  activeCategory?: string;
}

const { items, activeCategory = 'all' } = Astro.props;

const filteredItems = activeCategory === 'all'
  ? items
  : items.filter(item => item.categorySlug === activeCategory);
---

<div class="portfolio-grid" id="portfolio-grid">
  {
    filteredItems.map((item, index) => (
      <div
        class="portfolio-item group relative overflow-hidden cursor-pointer"
        data-category={item.categorySlug}
        data-index={index}
        data-title={item.title}
        data-description={item.description}
      >
        <!-- Image -->
        <img
          src={item.image}
          alt={item.description}
          width={item.width}
          height={item.height}
          class="portfolio-item-image w-full aspect-square object-cover transition-transform duration-500 group-hover:scale-110"
          loading="lazy"
        />

        <!-- Overlay -->
        <div class="portfolio-item-overlay absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex flex-col justify-end p-6">
          <!-- Category -->
          <span class="portfolio-item-category text-accent text-sm font-semibold mb-2">
            {item.category}
          </span>

          <!-- Title -->
          <h3 class="portfolio-item-title text-white text-xl md:text-2xl font-bold leading-tight">
            {item.title}
          </h3>

          <!-- Description (hidden on mobile, visible on desktop) -->
          <p class="portfolio-item-description text-gray-200 text-sm mt-2 hidden md:block line-clamp-2">
            {item.description}
          </p>
        </div>

        <!-- Zoom icon on hover -->
        <div class="portfolio-item-zoom absolute top-4 right-4 w-10 h-10 bg-white/90 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300 transform translate-y-[-10px] group-hover:translate-y-0">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 text-gray-900">
            <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607zM10.5 7.5v6m3-3h-6" />
          </svg>
        </div>
      </div>
    ))
  }
</div>

<style>
  .portfolio-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1rem;
  }

  @media (min-width: 640px) {
    .portfolio-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 1.5rem;
    }
  }

  @media (min-width: 1024px) {
    .portfolio-grid {
      grid-template-columns: repeat(3, 1fr);
      gap: 2rem;
    }
  }

  @media (min-width: 1280px) {
    .portfolio-grid {
      grid-template-columns: repeat(4, 1fr);
    }
  }

  .portfolio-item {
    border-radius: 0.5rem;
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
    transition: box-shadow 0.3s ease;
  }

  .portfolio-item:hover {
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
  }

  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>

<script>
  // Handle click events to open lightbox
  document.addEventListener('astro:page-load', () => {
    const portfolioItems = document.querySelectorAll('.portfolio-item');

    portfolioItems.forEach((item) => {
      item.addEventListener('click', () => {
        const index = parseInt(item.getAttribute('data-index') || '0');
        if ((window as any).openLightbox) {
          (window as any).openLightbox(index);
        }
      });
    });
  });
</script>
