---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map(post => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();

// Get related posts (same category, exclude current)
const allPosts = await getCollection('blog');
const relatedPosts = allPosts
  .filter(p => p.slug !== post.slug && p.data.category === post.data.category)
  .slice(0, 3);
---

<BaseLayout title={post.data.title} description={post.data.description} image={post.data.image || '/images/hero/no-min-order-banner.png'}>
  <main>
    <!-- Single Post Content - EXACTLY like OG -->
    <div id="primary" class="content-area">
      <main id="main" class="site-main uicore-section uicore-box uicore">
        <div class="uicore uicore-container uicore-content-wrapper uicore-blog-animation">
          <div class="uicore-type-post uicore-post-content uicore-animate">
            <article class={`blog-fonts post-${post.slug} post type-post status-publish format-standard has-post-thumbnail hentry category-${post.data.category.toLowerCase()}`}>
              <!-- Single Post Header - EXACTLY like OG -->
              <header class="uicore-single-header">
                <h1 class="entry-title uicore-animate">{post.data.title}</h1>
                <div class="uicore-entry-meta uicore-animate">
                  <div>
                    <a href="/blog/" title={`Posts by ${post.data.author}`} rel="author">{post.data.author}</a>
                    <span class="uicore-meta-separator"></span>
                  </div>
                  <span class="ui-blog-date ui-published">
                    {post.data.pubDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
                  </span>
                  <span class="uicore-meta-separator"></span>
                  <div class="uicore-post-category uicore-body">
                    <a href={`/blog/?category=${post.data.category}`} rel="category tag">{post.data.category}</a>
                  </div>
                  <span class="uicore-meta-separator"></span>
                  <span class="uicore-post-readtime">3 min read</span>
                </div>
                {post.data.image && (
                  <div class="uicore-feature-img-wrapper uicore-animate">
                    <img
                      loading="lazy"
                      width="1000"
                      height="777"
                      src={post.data.image}
                      class="attachment-large size-large wp-post-image"
                      alt={post.data.title}
                      decoding="async"
                    />
                  </div>
                )}
              </header>

              <!-- Entry Content - EXACTLY like OG -->
              <div class="entry-content">
                <div class="blog-fonts">
                  <Content />
                </div>
              </div>

              <!-- Entry Footer with Tags - EXACTLY like OG -->
              <footer class="entry-footer">
                {post.data.tags && post.data.tags.length > 0 && (
                  <div class="tags-links">
                    {post.data.tags.map(tag => (
                      <a href={`/blog/?tag=${tag}`} rel="tag">{tag}</a>
                    ))}
                  </div>
                )}
              </footer>
            </article>

            <!-- Related Posts -->
            {relatedPosts.length > 0 && (
              <section class="uicore-related">
                <div class="uicore-container">
                  <h3 class="uicore-related-title">Related Posts</h3>
                  <div class="uicore-grid-container uicore-blog-grid uicore-grid-row uicore-portrait-ratio uicore-small-space">
                    {relatedPosts.map((relatedPost) => (
                      <div class="uicore-grid-item uicore-col-md-6 uicore-col-lg-6 uicore-zoom uicore-animate">
                        <article class="uicore-post">
                          <div class="uicore-post-wrapper">
                            <a href={`/blog/${relatedPost.slug}/`} title={`View Post: ${relatedPost.data.title}`}>
                              <div class="uicore-blog-img-container uicore-zoom-wrapper">
                                <div class="uicore-cover-img" style={`background-image: url(${relatedPost.data.image || '/images/hero/no-min-order-banner.png'})`}></div>
                              </div>
                            </a>
                            <div class="uicore-post-info">
                              <div class="uicore-post-info-wrapper">
                                <div class="uicore-post-category uicore-body">
                                  <a href={`/blog/?category=${relatedPost.data.category}`} title={`View ${relatedPost.data.category} posts`}>{relatedPost.data.category}</a>
                                </div>
                                <a href={`/blog/${relatedPost.slug}/`} title={`View Post: ${relatedPost.data.title}`}>
                                  <h4 class="uicore-post-title"><span>{relatedPost.data.title}</span></h4>
                                </a>
                                <p>{relatedPost.data.description}</p>
                                <div class="uicore-post-footer uicore-body">
                                  <span><a href="/blog/">{relatedPost.data.author}</a></span>
                                  <span class="uicore-meta-separator"></span>
                                  <span>{relatedPost.data.pubDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</span>
                                  <span class="uicore-meta-separator"></span>
                                  <span>3 min read</span>
                                </div>
                              </div>
                            </div>
                          </div>
                        </article>
                      </div>
                    ))}
                  </div>
                </div>
              </section>
            )}
          </div>
        </div>
      </main>
    </div>
  </main>
</BaseLayout>

<style>
  /* EXACT OG Styles for Single Post */

  /* Single Post Layout - Same as blog listing */
  .content-area {
    width: 100%;
  }

  .site-main.uicore {
    padding: 100px 0;
  }

  .uicore-container {
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
  }

  .uicore-type-post {
    width: 100%;
    margin: 0 auto;
  }

  /* Single Post Header */
  .uicore-single-header {
    margin-bottom: 40px;
  }

  .entry-title {
    font-family: 'Inter', system-ui, sans-serif;
    font-weight: normal;
    line-height: 1.2;
    letter-spacing: -0.027em;
    text-transform: none;
    font-style: normal;
    font-size: 72px;
    color: #070707;
    margin: 0 0 20px 0;
  }

  .uicore-entry-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5em;
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.04em;
    line-height: 11px;
    font-weight: 600;
    color: #6e7a84;
  }

  .uicore-entry-meta a,
  .uicore-entry-meta span {
    color: #6e7a84;
  }

  .uicore-entry-meta a:hover {
    color: #f97316;
  }

  .uicore-meta-separator {
    margin: 0 0.5em;
  }

  .uicore-post-category {
    display: inline-block;
    line-height: inherit;
  }

  .uicore-post-category a {
    text-decoration: none;
    color: #6e7a84;
  }

  .uicore-post-category a:hover {
    color: #f97316;
  }

  .uicore-feature-img-wrapper {
    margin: 2em 0;
  }

  .uicore-feature-img-wrapper img {
    max-width: 100%;
    height: auto;
    display: block;
    border-radius: 6px;
  }

  /* Entry Content */
  .entry-content {
    width: 100%;
  }

  .blog-fonts {
    font-family: 'Inter', system-ui, -apple-system, sans-serif;
    color: #070707;
    line-height: 1.8;
    font-size: 16px;
  }

  /* Blog Typography - EXACT OG styles */
  .blog-fonts h1,
  .blog-fonts h2,
  .blog-fonts h3,
  .blog-fonts h4,
  .blog-fonts h5,
  .blog-fonts h6 {
    font-family: 'Inter', system-ui, sans-serif;
    color: #070707;
    margin-top: 1em;
    margin-bottom: 0.5em;
    font-weight: normal;
  }

  .blog-fonts h1 {
    font-size: 72px;
    line-height: 1.2;
    letter-spacing: -0.027em;
  }

  .blog-fonts h2 {
    font-size: 40px;
    line-height: 1.2;
    letter-spacing: -0.027em;
  }

  .blog-fonts h3 {
    font-size: 34px;
    line-height: 1.25;
    letter-spacing: 0em;
  }

  .blog-fonts h4 {
    font-size: 20px;
    line-height: 1.1;
    letter-spacing: 0em;
  }

  .blog-fonts h5 {
    font-size: 16px;
    line-height: 1.1;
    letter-spacing: 0em;
  }

  .blog-fonts h6 {
    font-size: 14px;
    line-height: 1.1;
    letter-spacing: 0em;
    text-transform: uppercase;
  }

  .blog-fonts p {
    margin: 9px 0 0;
    font-size: 16px;
    line-height: 1.875;
  }

  .blog-fonts strong,
  .blog-fonts b {
    font-weight: 600;
    color: #070707;
  }

  .blog-fonts a {
    color: #f97316;
    text-decoration: none;
  }

  .blog-fonts a:hover {
    color: #ea580c;
  }

  .blog-fonts ul,
  .blog-fonts ol {
    padding-left: 1em;
    margin: 9px 0 0;
  }

  .blog-fonts li {
    margin: 9px 0 0;
  }

  .blog-fonts blockquote {
    margin: 20px auto;
    padding: 50px 70px;
    background-color: hsl(0 0% 98% / 0.9);
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23666'%3E%3Cpath d='M14.017 21L14.017 18C14.017 16.8954 13.1216 16 12.017 16H11C9.89543 16 9 15.1046 9 14V9C9 7.89543 9.89543 7 11 7H12C13.2091 7 15 8.79086 15 11V14C15 16.1046 14.1046 17 13 17H14.017V21ZM5 21L5 18C5 16.8954 4.10457 16 3 16H2C0.895431 16 0 15.1046 0 14V9C0 7.89543 0.895431 7 2 7H3C5.20914 7 7 8.79086 7 11V14C7 15.1046 6.10457 16 5 16H5V21Z'/%3E%3C/svg%3E");
    background-position: 30px 70%;
    background-repeat: no-repeat;
    background-size: 15% auto;
    font-size: 120%;
    line-height: 1.5;
  }

  .blog-fonts blockquote p {
    margin-bottom: 0;
  }

  .blog-fonts table {
    empty-cells: show;
    border: 1px solid #e6e9ec;
    margin: 18px 0;
    border-collapse: collapse;
    border-spacing: 0;
    width: 100%;
  }

  .blog-fonts table td,
  .blog-fonts table th {
    background-color: #fff;
    border-left: 1px solid #e6e9ec;
    border-bottom: 1px solid #e6e9ec;
    font-size: inherit;
    margin: 0;
    overflow: visible;
    padding: 5px;
    font-weight: 600;
  }

  .blog-fonts table td:first-child,
  .blog-fonts table th:first-child {
    border-left-width: 0;
  }

  .blog-fonts table th {
    font-weight: 600;
  }

  /* Entry Footer - Tags */
  .entry-footer {
    margin-top: 36px;
    padding-top: 36px;
    border-top: 1px solid #e6e9ec;
  }

  .tags-links {
    display: flex;
    flex-wrap: wrap;
    margin: -5px;
    padding: 10px 0 0;
  }

  .tags-links a {
    font-size: 10px !important;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 1px;
    padding: 10px 15px;
    border: 1px solid #e6e9ec;
    margin: 5px;
    line-height: 1.5;
    text-decoration: none;
    color: #6e7a84;
    transition: all 0.3s;
  }

  .tags-links a:hover {
    border-color: #a3afb7;
    background: #f97316;
    color: #fff;
  }

  /* Related Posts Section */
  .uicore-related {
    margin-top: 60px;
    padding-top: 60px;
    border-top: 1px solid #e6e9ec;
  }

  .uicore-related-title {
    font-size: 24px;
    font-weight: 600;
    margin-bottom: 30px;
    color: #070707;
  }

  /* Grid System for Related Posts */
  .uicore-grid-container {
    position: relative;
    display: flex;
    flex-wrap: wrap;
    margin: -15px;
  }

  .uicore-grid-item {
    position: relative;
    width: 100%;
    padding: 15px;
  }

  .uicore-col-md-6 {
    width: 50%;
  }

  .uicore-col-lg-6 {
    width: 50%;
  }

  @media (max-width: 767px) {
    .uicore-col-md-6,
    .uicore-col-lg-6 {
      width: 100%;
    }
  }

  /* Blog Card Styles - Same as listing */
  .uicore-blog-grid .uicore-post {
    border: 1px solid #ebebeb;
    border-radius: 6px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.04), 0 48px 60px 0 rgba(17, 12, 46, 0.08);
    background: #fff;
    transition: box-shadow 0.4s cubic-bezier(0.4, 0, 0.2, 1), transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    height: 100%;
    display: flex;
    flex-direction: column;
  }

  .uicore-blog-grid .uicore-post:hover {
    transform: translateY(-10px);
    box-shadow: 0 15px 15px rgba(0, 0, 0, 0.06), 0 48px 60px 0 rgba(17, 12, 46, 0.08);
  }

  .uicore-post-wrapper {
    display: flex;
    flex-direction: column;
    height: 100%;
  }

  .uicore-blog-img-container {
    overflow: hidden;
    border-radius: 6px;
    border-bottom-left-radius: 0;
    border-bottom-right-radius: 0;
  }

  .uicore-zoom-wrapper {
    height: 0;
    padding-bottom: 100%;
    overflow: hidden;
  }

  .uicore-zoom .uicore-cover-img {
    transform: scale(1);
    background-position: 50%;
    transition: transform 0.8s cubic-bezier(0.075, 0.82, 0.165, 1);
  }

  .uicore-zoom:hover .uicore-cover-img {
    transform: scale(1.2);
  }

  .uicore-cover-img {
    width: 100%;
    background-position: 50%;
    background-size: cover;
    padding-bottom: 100%;
    display: block;
  }

  .uicore-post-info {
    padding: 30px 28px !important;
    margin: 0 !important;
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  .uicore-post-info-wrapper {
    display: flex;
    flex-direction: column;
    height: 100%;
  }

  .uicore-post-category {
    margin-bottom: 1em;
  }

  .uicore-post-category a {
    display: inline-block;
    text-decoration: none;
    color: #6e7a84;
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.04em;
    line-height: 11px;
    font-weight: 600;
  }

  .uicore-post-category a:hover {
    color: #f97316;
  }

  .uicore-post-title {
    font-family: 'Inter', system-ui, sans-serif;
    font-weight: 600;
    line-height: 1.44;
    letter-spacing: 0em;
    color: #070707;
    font-size: 18px;
    margin: 0;
    transition: all 0.25s cubic-bezier(0.42, 0, 0.29, 1.16);
  }

  .uicore-post-title a {
    color: inherit;
    text-decoration: none;
  }

  .uicore-post-title:hover {
    color: #f97316;
  }

  .uicore-post-info p {
    font-family: 'Inter', system-ui, sans-serif;
    font-weight: 600;
    line-height: 1.57;
    letter-spacing: 0em;
    color: #070707;
    font-size: 14px;
    margin: 1em 0 0;
  }

  .uicore-post-footer {
    font-size: 11px;
    margin-top: 1.5em;
    margin-top: auto;
    padding-top: 1.5em;
    color: #6e7a84;
    text-transform: uppercase;
    letter-spacing: 0.04em;
    line-height: 11px;
    font-weight: 600;
  }

  /* Responsive */
  @media (max-width: 1024px) {
    .entry-title {
      font-size: 48px;
    }

    .blog-fonts h1 {
      font-size: 48px;
    }

    .blog-fonts h2 {
      font-size: 34px;
    }

    .blog-fonts h3 {
      font-size: 26px;
    }

    .site-main.uicore {
      padding: 75px 0;
    }
  }

  @media (max-width: 767px) {
    .entry-title {
      font-size: 34px;
    }

    .blog-fonts h1 {
      font-size: 34px;
    }

    .blog-fonts h2 {
      font-size: 26px;
    }

    .blog-fonts h3 {
      font-size: 20px;
    }

    .blog-fonts p {
      font-size: 16px;
    }

    .site-main.uicore {
      padding: 45px 0;
    }

    .uicore-container {
      padding: 0 15px;
    }
  }
</style>
